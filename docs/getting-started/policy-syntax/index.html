<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical href=https://cloudaspect.app/docs/getting-started/policy-syntax/><title>Policy Syntax | Aspect</title><link href=https://cloudaspect.appcss/fontawesome.min.css rel=stylesheet><link rel=stylesheet href=https://cloudaspect.app/css/ace.min.css></head><body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain><div class=container><div><a class=navbar-brand href=/>Aspect</a></div><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMainCollapse><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://github.com/im5tu/aspect target=_blank><i class="fab fa-github"></i></a></li></ul></div></div></nav><div class=container-fluid><div class=row><div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0"><button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse><form class="form-inline my-2 my-lg-0 searchbox"><input class="form-control mr-sm-2 w-100" data-search-input id=search-by type=text placeholder=Search></form><ul class="navbar-nav flex-column pt-3"><li data-nav-id=/docs/ class="nav-item my-1 parent haschildren"><a class="nav-link p-0" href=/docs/><h6>Aspect Documentation</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/getting-started/ class="nav-item my-1 parent haschildren"><a class="nav-link p-0" href=/docs/getting-started/><h6>Getting started</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/getting-started/installation/ class="nav-item my-1"><a href=/docs/getting-started/installation/ class="nav-link p-0">Installation</a></li><li data-nav-id=/docs/getting-started/policy-syntax/ class="nav-item my-1 active"><a href=/docs/getting-started/policy-syntax/ class="nav-link p-0">Policy Syntax</a></li><li data-nav-id=/docs/getting-started/policy-suite-syntax/ class="nav-item my-1"><a href=/docs/getting-started/policy-suite-syntax/ class="nav-link p-0">Policy Suite Syntax</a></li><li data-nav-id=/docs/getting-started/builtin-functions/ class="nav-item my-1"><a href=/docs/getting-started/builtin-functions/ class="nav-link p-0">Builtin Functions</a></li></ul></li><li data-nav-id=/docs/cli-commands/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/cli-commands/><h6>Cli Commands</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/cli-commands/aspect-inspect/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-inspect/ class="nav-link p-0">aspect inspect</a></li><li data-nav-id=/docs/cli-commands/aspect-policy-build/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-policy-build/ class="nav-link p-0">aspect policy build</a></li><li data-nav-id=/docs/cli-commands/aspect-policy-init/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-policy-init/ class="nav-link p-0">aspect policy init</a></li><li data-nav-id=/docs/cli-commands/aspect-policy-list/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-policy-list/ class="nav-link p-0">aspect policy list</a></li><li data-nav-id=/docs/cli-commands/aspect-policy-validate/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-policy-validate/ class="nav-link p-0">aspect policy validate</a></li><li data-nav-id=/docs/cli-commands/aspect-policy-view/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-policy-view/ class="nav-link p-0">aspect policy view</a></li><li data-nav-id=/docs/cli-commands/aspect-resources/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-resources/ class="nav-link p-0">aspect resources</a></li><li data-nav-id=/docs/cli-commands/aspect-run/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-run/ class="nav-link p-0">aspect run</a></li><li data-nav-id=/docs/cli-commands/aspect-watch/ class="nav-item my-1"><a href=/docs/cli-commands/aspect-watch/ class="nav-link p-0">aspect watch</a></li></ul></li><li data-nav-id=/docs/aws/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/aws/><h6>AWS</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/aws/configuration/ class="nav-item my-1"><a href=/docs/aws/configuration/ class="nav-link p-0">Configuration</a></li><li data-nav-id=/docs/aws/resources/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/aws/resources/><h6>Resources</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/aws/resources/awsaccount/ class="nav-item my-1"><a href=/docs/aws/resources/awsaccount/ class="nav-link p-0">AwsAccount</a></li><li data-nav-id=/docs/aws/resources/awsec2image/ class="nav-item my-1"><a href=/docs/aws/resources/awsec2image/ class="nav-link p-0">AwsEc2Image</a></li><li data-nav-id=/docs/aws/resources/awsec2instance/ class="nav-item my-1"><a href=/docs/aws/resources/awsec2instance/ class="nav-link p-0">AwsEc2Instance</a></li><li data-nav-id=/docs/aws/resources/awsec2keypair/ class="nav-item my-1"><a href=/docs/aws/resources/awsec2keypair/ class="nav-link p-0">AwsEc2KeyPair</a></li><li data-nav-id=/docs/aws/resources/awsec2snapshot/ class="nav-item my-1"><a href=/docs/aws/resources/awsec2snapshot/ class="nav-link p-0">AwsEc2Snapshot</a></li><li data-nav-id=/docs/aws/resources/awsec2volume/ class="nav-item my-1"><a href=/docs/aws/resources/awsec2volume/ class="nav-link p-0">AwsEc2Volume</a></li><li data-nav-id=/docs/aws/resources/awselasticip/ class="nav-item my-1"><a href=/docs/aws/resources/awselasticip/ class="nav-link p-0">AwsElasticIp</a></li><li data-nav-id=/docs/aws/resources/awsinternetgateway/ class="nav-item my-1"><a href=/docs/aws/resources/awsinternetgateway/ class="nav-link p-0">AwsInternetGateway</a></li><li data-nav-id=/docs/aws/resources/awsnatgateway/ class="nav-item my-1"><a href=/docs/aws/resources/awsnatgateway/ class="nav-link p-0">AwsNatGateway</a></li><li data-nav-id=/docs/aws/resources/awsnetworkinterface/ class="nav-item my-1"><a href=/docs/aws/resources/awsnetworkinterface/ class="nav-link p-0">AwsNetworkInterface</a></li><li data-nav-id=/docs/aws/resources/awsprefixlist/ class="nav-item my-1"><a href=/docs/aws/resources/awsprefixlist/ class="nav-link p-0">AwsPrefixList</a></li><li data-nav-id=/docs/aws/resources/awsreservedinstance/ class="nav-item my-1"><a href=/docs/aws/resources/awsreservedinstance/ class="nav-link p-0">AwsReservedInstance</a></li><li data-nav-id=/docs/aws/resources/awsroutetable/ class="nav-item my-1"><a href=/docs/aws/resources/awsroutetable/ class="nav-link p-0">AwsRouteTable</a></li><li data-nav-id=/docs/aws/resources/awssecuritygroup/ class="nav-item my-1"><a href=/docs/aws/resources/awssecuritygroup/ class="nav-link p-0">AwsSecurityGroup</a></li><li data-nav-id=/docs/aws/resources/awstransitgateway/ class="nav-item my-1"><a href=/docs/aws/resources/awstransitgateway/ class="nav-link p-0">AwsTransitGateway</a></li><li data-nav-id=/docs/aws/resources/awsvpc/ class="nav-item my-1"><a href=/docs/aws/resources/awsvpc/ class="nav-link p-0">AwsVpc</a></li></ul></li></ul></li><li data-nav-id=/docs/azure/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/azure/><h6>Azure</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/azure/configuration/ class="nav-item my-1"><a href=/docs/azure/configuration/ class="nav-link p-0">Configuration</a></li><li data-nav-id=/docs/azure/resources/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/azure/resources/><h6>Resources</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/azure/resources/azureaccount/ class="nav-item my-1"><a href=/docs/azure/resources/azureaccount/ class="nav-link p-0">AzureAccount</a></li></ul></li></ul></li><li data-nav-id=/docs/builtin/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/builtin/><h6>BuiltIn Policies</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/builtin/aws/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/builtin/aws/><h6>AWS</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/builtin/aws/aws_allregions_bestpractises/ class="nav-item my-1"><a href=/docs/builtin/aws/aws_allregions_bestpractises/ class="nav-link p-0">AWS_AllRegions_BestPractises.suite</a></li><li data-nav-id=/docs/builtin/aws/awsec2image_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2image_tagging/ class="nav-link p-0">AwsEc2Image_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2instance_monitoring/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2instance_monitoring/ class="nav-link p-0">AwsEc2Instance_Monitoring.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2instance_privateinstance/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2instance_privateinstance/ class="nav-link p-0">AwsEc2Instance_PrivateInstance.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2instance_sourcedestinationchecks/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2instance_sourcedestinationchecks/ class="nav-link p-0">AwsEc2Instance_SourceDestinationChecks.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2instance_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2instance_tagging/ class="nav-link p-0">AwsEc2Instance_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2keypair_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2keypair_tagging/ class="nav-link p-0">AwsEc2KeyPair_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2snapshot_encryption/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2snapshot_encryption/ class="nav-link p-0">AwsEc2Snapshot_Encryption.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2snapshot_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2snapshot_tagging/ class="nav-link p-0">AwsEc2Snapshot_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2volume_encryption/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2volume_encryption/ class="nav-link p-0">AwsEc2Volume_Encryption.policy</a></li><li data-nav-id=/docs/builtin/aws/awsec2volume_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsec2volume_tagging/ class="nav-link p-0">AwsEc2Volume_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awselasticip_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awselasticip_tagging/ class="nav-link p-0">AwsElasticIp_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsinternetgateway_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsinternetgateway_tagging/ class="nav-link p-0">AwsInternetGateway_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsnatgateway_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsnatgateway_tagging/ class="nav-link p-0">AwsNatGateway_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsprefixlist_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsprefixlist_tagging/ class="nav-link p-0">AwsPrefixList_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsreservedinstance_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsreservedinstance_tagging/ class="nav-link p-0">AwsReservedInstance_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awsroutetable_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awsroutetable_tagging/ class="nav-link p-0">AwsRouteTable_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awssecuritygroup_egress_nopublicaccess/ class="nav-item my-1"><a href=/docs/builtin/aws/awssecuritygroup_egress_nopublicaccess/ class="nav-link p-0">AwsSecurityGroup_Egress_NoPublicAccess.policy</a></li><li data-nav-id=/docs/builtin/aws/awssecuritygroup_ingress_nopublicaccess/ class="nav-item my-1"><a href=/docs/builtin/aws/awssecuritygroup_ingress_nopublicaccess/ class="nav-link p-0">AwsSecurityGroup_Ingress_NoPublicAccess.policy</a></li><li data-nav-id=/docs/builtin/aws/awssecuritygroup_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awssecuritygroup_tagging/ class="nav-link p-0">AwsSecurityGroup_Tagging.policy</a></li><li data-nav-id=/docs/builtin/aws/awstransitgateway_tagging/ class="nav-item my-1"><a href=/docs/builtin/aws/awstransitgateway_tagging/ class="nav-link p-0">AwsTransitGateway_Tagging.policy</a></li></ul></li></ul></li><li data-nav-id=/docs/contributing/ class="nav-item my-1 haschildren"><a class="nav-link p-0" href=/docs/contributing/><h6>Contributing</h6></a><ul class="list-unstyled ml-2"><li data-nav-id=/docs/contributing/local-development/ class="nav-item my-1"><a href=/docs/contributing/local-development/ class="nav-link p-0">Developing Locally</a></li><li data-nav-id=/docs/contributing/add-new-builtin-functions/ class="nav-item my-1"><a href=/docs/contributing/add-new-builtin-functions/ class="nav-link p-0">Adding New Functions</a></li><li data-nav-id=/docs/contributing/code-of-conduct/ class="nav-item my-1"><a href=/docs/contributing/code-of-conduct/ class="nav-link p-0">Code of Conduct</a></li></ul></li></ul></li></ul></div></nav></div><div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky border-left"><div class=docs-toc><nav id=TableOfContents><ul><li><a href=#statement-blocks>Statement Blocks</a></li><li><a href=#operators>Operators</a></li><li><a href=#type-system>Type System</a><ul><li><a href=#type-coercion>Type coercion</a></li><li><a href=#collections>Collections</a></li></ul></li><li><a href=#functions>Functions</a></li><li><a href=#evaluation-logic>Evaluation Logic</a></li></ul></nav></div></div><div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3"><h1>Policy Syntax</h1><p>Policies are at the core of Aspect, driving all of the evaluation logic whether it&rsquo;s coming from the <a href=/docs/cli-commands/aspect-inspect/>REPL UI</a>, from a file on disk, or one of the <a href=/docs/builtin>BuiltIn Policies</a>. The syntax of the document is largely inspired by Rego, from the Open Policy Agent project. Each policy must have a minimum of two parts: a <code>resource</code> statement and a <code>validate</code> statement block.</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_aa41399b7d>
Copy</button></div><div id=clipboard_aa41399b7d><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=color:#66d9ef>
</span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;AwsSecurityGroup&#34;</span>

<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Name</span> =<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;default&#34;</span>
}

</code></pre></div></div></div><p>The resource can be any of one of the supported resources, which you can view from running <a href=/docs/cli-commands/aspect-resources/><code>aspect resources</code></a>. Once set, you have access to a special variable called <code>input</code> which allows you access to the currently evaluating resource in any one of the statement blocks. From here, you will get full type checking during policy evaluation and validation. To view the available properties for a specific resource, follow the documentation link generated by <a href=/docs/cli-commands/aspect-resources/><code>aspect resources</code></a>.</p><h2 id=statement-blocks>Statement Blocks</h2><p>There are three available statement blocks that can be defined in any order: <code>include</code>, <code>exclude</code>, <code>validate</code>. Each one of the statement blocks has the exact same structure:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_abdbc0aee7>
Copy</button></div><div id=clipboard_abdbc0aee7><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>block</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>expression</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>expression</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>expression</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>&gt;</span>
}

</code></pre></div></div></div><p>Each statement within a statement block is newline delimited and then logically anded together with the previous statements. If any statement does not successfuly validate against the specified input, then the statement block fails. The effect of a statement block failure depends on the nature of the block. See the <a href=#evaluation-logic>Evaluation Logic</a> for more details.</p><p>Each statement expression is always one of the following syntaxes:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_41aa36d3f1>
Copy</button></div><div id=clipboard_41aa36d3f1><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>block</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>accessor</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operator</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>function</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span>(<span style=color:#a6e22e>input</span>.<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>accessor</span><span style=color:#f92672>&gt;</span>, <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>&gt;</span> [, <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span> <span style=color:#a6e22e>N</span><span style=color:#f92672>&gt;</span>])
}

</code></pre></div></div></div><p>Note how the <code>input</code> is always on the left side of the statement expression. The only time this is not strictly required is when there is a <a href=#functions>function call</a>. Let&rsquo;s take a look at an example <code>validate</code> block:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_2c5dc9f2c7>
Copy</button></div><div id=clipboard_2c5dc9f2c7><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Name</span> =<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Test&#34;</span>
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Region</span> =<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;eu-west-1&#34;</span>
}

</code></pre></div></div></div><p>In the above statement block, we have defined two statements:</p><ol><li><code>input.Name == "Test"</code> - The name of the resource must be equal to <code>Test</code></li><li><code>input.Region == "eu-west-1"</code> - The resource must be in the <code>eu-west-1</code> region</li></ol><p>If either of the above conditions fails, then the corresponding statement block (<code>validate</code> in this example) fails. The following statement blocks are available to be defined in any other:</p><div class="table table-striped" role=alert><table><thead><tr><th>Name</th><th>Description</th><th>Required?</th></tr></thead><tbody><tr><td>validate</td><td>Validates a cloud resource against the specified criteria. This block must contain at least one statement.</td><td>Yes</td></tr><tr><td>include</td><td>Include resources that match the specified criteria</td><td>No</td></tr><tr><td>Exclude</td><td>Exclude resources that match the specified criteria</td><td>No</td></tr></tbody></table></div><p>Note: <em>Statement blocks cannot be nested inside of one another.</em></p><p>If a resource has nested properties, use dot notation to access the properties, for example:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_a4c1009e00>
Copy</button></div><div id=clipboard_a4c1009e00><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Account</span>.<span style=color:#a6e22e>Id</span> =<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Test&#34;</span>
}

</code></pre></div></div></div><h2 id=operators>Operators</h2><p>Depending on the type that you are evaluating, the following operators are available to use:</p><div class="table table-striped" role=alert><table><thead><tr><th>Operator</th><th>Available on Types</th><th>Description</th></tr></thead><tbody><tr><td>==</td><td>String, Boolean, Number</td><td>The left operand must be <strong>equal</strong> to the right operand</td></tr><tr><td>!=</td><td>String, Boolean, Number</td><td>The left operand must <strong>not be equal</strong> to the right operand</td></tr><tr><td>></td><td>Number</td><td>The left operand must be <strong>greater than</strong> the right operand</td></tr><tr><td>>=</td><td>Number</td><td>The left operand must be <strong>greater than or equal to</strong> the right operand</td></tr><tr><td>&lt;</td><td>Number</td><td>The left operand must be <strong>less than</strong> the right operand</td></tr><tr><td>&lt;=</td><td>Number</td><td>The left operand must be <strong>less than or equal to</strong> the right operand</td></tr></tbody></table></div><h2 id=type-system>Type System</h2><p>Aspects type system is designed to be as simple as possible to reason about. Therefore, we only have the following types:</p><div class="table table-striped" role=alert><table><thead><tr><th>Name</th><th>Description</th><th>Examples</th></tr></thead><tbody><tr><td>String</td><td>Represents a peice of text</td><td>&ldquo;Hello&rdquo;, &ldquo;World&rdquo;</td></tr><tr><td>Number</td><td>Represents either an integer or decimal value, which can either be positive or negative. Subject to type coercion</td><td>-1, 1, 3.142</td></tr><tr><td>Boolean</td><td>Represents a true or false value</td><td>true, false</td></tr><tr><td>Collection&lt;T></td><td>Represents a collection of the specified type T, where T is either part of a resource or a KeyValuePair</td><td>[1,2,3]</td></tr><tr><td>KeyValuePair</td><td>Represents a key and value which both are of type String.</td><td>Key:Hello, Value:World</td></tr></tbody></table></div><h3 id=type-coercion>Type coercion</h3><p>Aspect performs some very basic type coercion on your behalf. For example, if you want to check if <code>1</code> is equal to <code>1.2</code>, Aspect will correct the data types if it can so that the equality check has a chance to succeed. If the input and the constant expressions can not be coerced, you will recieve a compiler error which will need to be fixed.</p><h3 id=collections>Collections</h3><p>A lot of the resources that area available in Aspect have one or more collections contained inside, often with resources nested underneath them. A good example of this is the <code>[AwsSecurityGroup](/docs/aws/resources/awssecuritygroup/)</code> which has the the <code>IngressRules</code> property, with a nested collection for <code>IPV4Ranges</code>. You can access collections using the following syntax declarations:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_b5bc49f165>
Copy</button></div><div id=clipboard_b5bc49f165><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>block</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>collection</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span>[<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>access</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>&gt;</span>] <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operator</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>&gt;</span>
}

</code></pre></div></div></div><p>The <code>&lt;access type></code> can either be set to ensure that all elements in a collection match the specified syntax, using the <code>input.&lt;collection name>[_]</code> syntax:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_83944eb545>
Copy</button></div><div id=clipboard_83944eb545><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>block</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>collection</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span>[<span style=color:#960050;background-color:#1e0010>_</span>] <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operator</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>&gt;</span>
}<span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e># eg:
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>CollectionOfNumbers</span>[<span style=color:#960050;background-color:#1e0010>_</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>
}

</code></pre></div></div></div><p>; or they can be set to match any element in the collection using the <code>input.&lt;collection name>[*]</code> syntax:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_7c68aeafb9>
Copy</button></div><div id=clipboard_7c68aeafb9><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>statement</span> <span style=color:#a6e22e>block</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>collection</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;</span>[<span style=color:#f92672>*</span>] <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operator</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>constant</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>&gt;</span>
}<span style=color:#75715e>
</span><span style=color:#75715e>
</span><span style=color:#75715e># eg:
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>CollectionOfNumbers</span>[<span style=color:#f92672>*</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>
}

</code></pre></div></div></div><p>Take a look at the following examples of how to use collections:</p><div class="table table-striped" role=alert><table><thead><tr><th>input</th><th>Description</th></tr></thead><tbody><tr><td><code>input.Collection[_] == 1</code></td><td>All elements in <code>Collection</code> must be equal to <code>1</code></td></tr><tr><td><code>input.Collection[*] == 1</code></td><td>Any element in <code>Collection</code> must be equal to <code>1</code></td></tr><tr><td><code>input.Collection[_].SubCollection[*] == 1</code></td><td>All elements in <code>Collection</code> must have a <code>SubCollection</code> element equal to <code>1</code></td></tr><tr><td><code>input.Collection[*].SubCollection[_] == 1</code></td><td>Any element in <code>Collection</code> must have all elements in <code>SubCollection</code> equal to <code>1</code></td></tr></tbody></table></div><h2 id=functions>Functions</h2><p>When building your policies, you may which to perform certain operations like seeing whether or not a string contains a specific value. Aspect provides you with a set of built in functions to help you. Please see the <a href=/docs/getting-started/builtin-functions/>BuiltIn Functions</a> documentation to see how to use functions properly.</p><div class="alert alert-danger" role=alert><strong>Note:</strong> <em>You cannot use functions with anything other than <code>collection&lt;KeyValuePair></code> which has limited function support.</em></div><h2 id=evaluation-logic>Evaluation Logic</h2><p>Now that we know the basics of constructing our policies, it&rsquo;s important to understand how the policies are evaluated against cloud resources. The flow is always:</p><ol><li>Discover all resources available</li><li>Remove any resources that do not validate against the <code>include</code> statement block</li><li>Remove any resources that do not validate against the <code>exclude</code> statement block</li><li>Validate the remaining resources against the <code>validate</code> statement block</li></ol><p>Or more visually:</p><p><img src=/img/policy-syntax/Full-Evaluation.png alt="Full Policy Valiation"></p><p>Let&rsquo;s take a look at this in more detail with a more real life scenario:</p><p class=lead>For each <code>AwsSecurityGroup</code> in the <code>Product-Group</code> <code>Contoso</code> where there is no tag <code>IsPublic</code> ensure that there are no global ingress rules</p><p>We would write the policy as follows:</p><div class=position-relative><div class=position-absolute style=right:0><button class="btn btn-light" data-clipboard-target=#clipboard_994e442cb6>
Copy</button></div><div id=clipboard_994e442cb6><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=color:#66d9ef>
</span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;AwsSecurityGroup&#34;</span>

<span style=color:#a6e22e>include</span> {
    <span style=color:#a6e22e>contains</span>(<span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Tags</span>, <span style=color:#e6db74>&#34;Product-Group&#34;</span>, <span style=color:#e6db74>&#34;Contoso&#34;</span>)
}

<span style=color:#a6e22e>exclude</span> {
    <span style=color:#a6e22e>contains</span>(<span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>Tags</span>, <span style=color:#e6db74>&#34;IsPublic&#34;</span>, <span style=color:#e6db74>&#34;true&#34;</span>)
}

<span style=color:#a6e22e>validate</span> {
    <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>EgressRules</span>[<span style=color:#f92672>*</span>].<span style=color:#a6e22e>IPV4Ranges</span>[<span style=color:#f92672>*</span>].<span style=color:#a6e22e>CIDR</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
}

</code></pre></div></div></div><p>Now, let&rsquo;s imagine that we have the following resources that were discovered:</p><ol><li>Security Group with an egress rule containing IPV4 CIDR Range 0.0.0.0/0<ul><li>Tags:<ul><li>Product-Group: Test</li></ul></li></ul></li><li>Security Group with an egress rule containing IPV4 CIDR Range 0.0.0.0/0<ul><li>Tags:<ul><li>Product-Group: Contoso</li></ul></li></ul></li><li>Security Group with an egress rule containing IPV4 CIDR Range 0.0.0.0/0<ul><li>Tags:<ul><li>Product-Group: Contoso</li><li>IsPublic: true</li></ul></li></ul></li><li>Security Group with an egress rule containing IPV4 CIDR Range 0.0.0.0/0<ul><li>Tags:<ul><li>Product-Group: Contoso</li><li>IsPublic: false</li></ul></li></ul></li></ol><p>Here is how the policy would be evaluated for the above resources:</p><ol><li>The <code>include</code> block would check to see whether each resource has the tag named <code>Product-Group</code> with the value <code>Contoso</code>. Resource #1 does not meet this condition, so it removed from further evaluations.</li><li>The <code>exclude</code> block would now be processed against resources 2, 3 & 4 as they all match the <code>Product-Group</code> tag. Resource #3 meets the criteria of having the tag <code>IsPublic</code> set to <code>true</code> so it is removed from further evaluations. Resource #4 does have the correct key, but an incorrect value so it remains for the final evaluation block.</li><li>The <code>validate</code> block is looking for any egress rule with an open CIDR range <code>0.0.0.0/0</code> which both the remaining resources (2 & 4) match. These resources are marked as failed.</li></ol><p>In quite a few scenarios, it&rsquo;s possible to merge the <code>include</code> and <code>exclude</code> statement expressions for smaller policies, but the flexibility is there should you need something more complex. The rule of thumb is always: how easy is this policy to reason about? will someone new understand this policy if they are new to the system?</p><div class=row></div></div></div></div><script src=https://cloudaspect.applib/jquery.min.js></script><script src=https://cloudaspect.applib/popper.min.js></script><script src=https://cloudaspect.appjs/bootstrap.min.js></script><script type=text/javascript src=/plugins/lunr.min.js></script><script type=text/javascript src=/plugins/auto-complete.js></script><link href=/plugins/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https://cloudaspect.app"</script><script type=text/javascript src=/plugins/search.js></script><script type=text/javascript src=/plugins/clipboard.js></script><script>new ClipboardJS('.btn')</script></body></html>